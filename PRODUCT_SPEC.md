# 貸款計算機 - 產品規格書

> 版本：1.0.0
> 最後更新：2026-01-05

---

## 1. 產品概述

### 1.1 產品名稱
貸款計算機 (Loan Calculator / ローン計算機)

### 1.2 產品定位
一款多語言、多幣別的網頁版貸款計算工具，協助使用者計算各類貸款的還款計劃，提供視覺化圖表與匯出功能。

### 1.3 目標使用者
- 有貸款需求的一般消費者
- 需要快速試算貸款方案的使用者
- 房貸、車貸、信貸申請者

---

## 2. 功能規格

### 2.1 多語言支援

| 語言 | 代碼 | 說明 |
|------|------|------|
| 繁體中文 | zh | 預設語言 |
| English | en | 英文介面 |
| 日本語 | ja | 日文介面 |

**實作方式**：透過設定齒輪按鈕開啟下拉選單選擇

---

### 2.2 多幣別支援

| 幣別 | 符號 | 小數位數 |
|------|------|----------|
| 台幣 (TWD) | NT$ | 0 |
| 日幣 (JPY) | ¥ | 0 |
| 美金 (USD) | $ | 2 |

**實作方式**：透過設定齒輪按鈕開啟下拉選單選擇

---

### 2.3 主題模式

| 主題 | 圖示 | 說明 |
|------|------|------|
| 淺色 (Light) | 🌤️ | 明亮背景，適合日間使用 |
| 深色 (Dark) | 🌙 | 深色背景，減少眼睛疲勞 |
| 夜間 (Night) | 🌃 | 極暗背景，適合夜間使用 |

**切換方式**：單一按鈕循環切換（點擊一次切換到下一個主題）

---

### 2.4 貸款類型

| 類型 | 預設年限 | 預設成數 |
|------|----------|----------|
| 房貸 (Mortgage) | 30 年 | 80% |
| 車貸 (Car Loan) | 5 年 | 100% |
| 信貸 (Personal Loan) | 5 年 | 100% |
| 其他 (Other) | 10 年 | 80% |

**功能說明**：
- 選擇「其他」時，顯示自訂輸入框供使用者輸入貸款類型名稱
- 切換貸款類型時，自動更新預設年限和成數

---

### 2.5 貸款輸入參數

#### 2.5.1 基本參數

| 參數 | 欄位 | 單位 | 預設值 | 說明 |
|------|------|------|--------|------|
| 貸款金額 | loanAmount | 幣別 | 1,000,000 | 總貸款金額 |
| 貸款成數 | loanRatio | % | 依類型 | 實際借款比例 |
| 貸款年限 | loanTerm | 年 | 依類型 | 還款期限 |
| 年利率 | interestRate | % | 2.0 | 年化利率 |

**版面配置**：貸款成數、年限、利率三欄水平並列，數字與單位整合於同一列

#### 2.5.2 寬限期設定

| 功能 | 說明 |
|------|------|
| 開關切換 | 可自由啟用/關閉寬限期功能 |
| 時間輸入 | 預設單位為「年」，可下拉切換為「月」 |
| 計算邏輯 | 寬限期內只繳利息，不還本金 |

---

### 2.6 還款方式

| 方式 | 中文名稱 | 說明 |
|------|----------|------|
| equalPayment | 本息平均攤還（等額本息） | 每月還款金額固定 |
| equalPrincipal | 本金平均攤還（等額本金） | 每月本金固定，利息遞減 |

---

### 2.7 額外費用

**功能說明**：
- 動態新增/刪除費用項目
- 每項費用包含：費用名稱、金額
- 即時計算並顯示總額外費用
- 費用納入 APR（總費用年百分率）計算

---

### 2.8 計算結果顯示

#### 2.8.1 摘要卡片

| 項目 | 說明 |
|------|------|
| 每月還款金額 | 有寬限期時顯示切換開關，可切換「寬限期內」/「寬限期後」金額 |
| 總還款金額 | 所有期數還款總和 |
| 總利息 | 支付的利息總額 |
| 總成本（含費用） | 總還款金額 + 額外費用 |
| 總費用年百分率 (APR) | 使用 IRR 方法計算，包含所有費用的實際年利率 |

#### 2.8.2 匯出/分享功能

**位置**：計算結果標題右側，單一分享圖案按鈕

**下拉選單選項**：
- 📄 CSV 匯出
- 📊 Excel 匯出
- 📑 PDF 匯出
- 🔗 分享（使用 Web Share API）

---

### 2.9 圖表功能

#### 2.9.1 還款金額趨勢圖

| 功能 | 說明 |
|------|------|
| 圖表類型 | 折線圖 (Line Chart) |
| 資料內容 | 每期還款金額變化 |
| 放大鏡按鈕 🔍 | 開啟彈窗，使用滑桿選擇期數查看該期詳細資訊 |
| 放大按鈕 ⛶ | 開啟全螢幕模式檢視 |
| 滾動功能 | 支援水平/垂直滾動 |

#### 2.9.2 本金利息累計圖

| 功能 | 說明 |
|------|------|
| 圖表類型 | 折線圖 (Line Chart) |
| 資料內容 | 累計已還本金、累計已還利息 |
| 放大鏡按鈕 🔍 | 開啟彈窗，使用滑桿選擇期數查看該期詳細資訊 |
| 放大按鈕 ⛶ | 開啟全螢幕模式檢視 |
| 滾動功能 | 支援水平/垂直滾動 |

---

### 2.10 還款明細表

#### 2.10.1 表格欄位

| 欄位 | 說明 |
|------|------|
| 期數 | 第幾期（寬限期標註「(寬限)」） |
| 還款金額 | 該期總還款金額 |
| 本金 | 該期償還本金 |
| 利息 | 該期支付利息 |
| 累計本金 | 累計已償還本金 |
| 累計利息 | 累計已支付利息 |
| 剩餘本金 | 尚未償還本金 |

#### 2.10.2 表格功能

| 功能 | 說明 |
|------|------|
| 固定欄寬 | 確保欄位對齊 |
| 等寬字型 | 數字使用等寬字型顯示 |
| 垂直/水平置中 | 文字對齊整齊 |
| 放大按鈕 ⛶ | 開啟全螢幕模式檢視 |
| 滾動功能 | 支援水平/垂直滾動 |
| 寬限期標示 | 寬限期列以特殊顏色標示 |

---

## 3. 介面規格

### 3.1 頁首區域

| 元素 | 說明 |
|------|------|
| 標題 | 「貸款計算機」（依語言切換） |
| 主題切換按鈕 | 單一圓形按鈕，顯示當前主題圖示 |
| 設定齒輪按鈕 | 點擊開啟下拉選單，包含語言和幣別選擇 |

### 3.2 版面配置

| 裝置 | 配置 |
|------|------|
| 電腦版 | 左側輸入區域（固定寬度 420px）、右側結果區域 |
| 平板/手機版 | 單欄垂直排列 |

### 3.3 留白規格

| 規格 | 說明 |
|------|------|
| 容器邊距 | 24px（手機 16px） |
| safe-area | 支援 iOS safe-area-inset |
| 元素間距 | 統一使用 8px 倍數 |

---

## 4. 技術規格

### 4.1 技術棧

| 項目 | 技術 |
|------|------|
| 前端框架 | 純 HTML + CSS + JavaScript（無框架） |
| 圖表函式庫 | Chart.js 4.x |
| PDF 匯出 | jsPDF 2.5.x + jsPDF-AutoTable 3.5.x |
| Excel 匯出 | SheetJS (xlsx) 0.18.5 |

### 4.2 檔案結構

```
貸款計算機/
├── index.html          # 主頁面結構
├── styles.css          # 樣式與主題定義
├── i18n.js             # 國際化系統
├── calculator.js       # 貸款計算核心邏輯
├── app.js              # 應用程式主控制器
├── DEVELOPMENT.md      # 開發筆記
└── PRODUCT_SPEC.md     # 產品規格書（本文件）
```

### 4.3 瀏覽器支援

| 瀏覽器 | 最低版本 |
|--------|----------|
| Chrome | 80+ |
| Firefox | 75+ |
| Safari | 13+ |
| Edge | 80+ |

### 4.4 響應式斷點

| 斷點 | 說明 |
|------|------|
| > 1024px | 電腦版（雙欄） |
| 768px - 1024px | 平板版（單欄） |
| < 768px | 手機版（單欄，調整字型） |
| < 480px | 小螢幕手機（進一步精簡） |

---

## 5. 資料儲存

### 5.1 LocalStorage

| Key | 說明 |
|-----|------|
| loanCalc_language | 使用者語言偏好 |
| loanCalc_theme | 使用者主題偏好 |
| loanCalc_currency | 使用者幣別偏好 |

---

## 6. 計算邏輯

### 6.1 本息平均攤還（等額本息）

```
月付金額 = 本金 × 月利率 × (1 + 月利率)^期數 / ((1 + 月利率)^期數 - 1)
```

### 6.2 本金平均攤還（等額本金）

```
每期本金 = 本金 / 期數
每期利息 = 剩餘本金 × 月利率
每期還款 = 每期本金 + 每期利息
```

### 6.3 寬限期計算

```
寬限期月付 = 本金 × 月利率（只繳利息）
寬限期結束後，以剩餘期數重新計算正常還款
```

### 6.4 APR 計算（總費用年百分率）

使用 IRR（內部報酬率）方法：
```
找出使 NPV = 0 的月利率 r
APR = (1 + r)^12 - 1
```

---

## 7. 版本歷史

| 版本 | 日期 | 變更內容 |
|------|------|----------|
| 1.0.0 | 2026-01-03 | 初始版本發布 |

---

## 8. 附錄：需求追溯

以下為開發過程中的需求演進記錄：

### 第一階段：基礎功能
- 多語言支援（中文/英文/日文）
- 多幣別支援（台幣/日幣）
- 三種主題模式（淺色/深色/夜間）
- 貸款類型選擇（房貸/車貸/信貸/其他）
- 兩種還款方式（本息平均/本金平均攤還）
- 額外費用動態新增
- 圖表顯示（還款趨勢、本金利息累計）
- 還款明細表
- 匯出功能（CSV/Excel/PDF）
- 分享功能（Web Share API）

### 第二階段：功能增強
- 新增美金幣別支援
- 主題選擇改為 Q 版按鈕
- 輸入欄位水平並列（成數/年限/利率）
- 新增寬限期功能
- 新增 APR 計算

### 第三階段：介面優化
- 主題切換整合為單一按鈕循環切換
- 輸入欄位數字與單位整合於同一列

### 第四階段：匯出與圖表優化
- 匯出功能整合為單一分享按鈕
- 圖表新增放大鏡查看每期詳細資訊
- 寬限期改為可開關選項
- 時間單位預設年可切換月
- 依貸款類型設定預設年限
- 還款明細表欄位對齊優化

### 第五階段：進階優化
- 信貸/車貸預設成數調整為 100%
- 新增設定齒輪按鈕整合語言/幣別選擇
- 頁面四周留白優化
- 每月還款金額寬限期切換顯示
- 圖表/表格全螢幕放大功能
- 圖表/表格滾動功能

---

*文件結束*
