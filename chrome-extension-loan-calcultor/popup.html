<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ë≤∏Ê¨æË®àÁÆóÊ©ü | Loan Calculator | „É≠„Éº„É≥Ë®àÁÆóÊ©ü</title>
    <link rel="stylesheet" href="styles.css">
</head>

<body class="theme-light">
    <div class="container">
        <!-- Main Content -->
        <main class="main-content">
            <!-- Input Section -->
            <section class="input-section">
                <div class="section-header">
                    <h2 data-i18n="loanDetails">Ë≤∏Ê¨æË≥áË®ä</h2>
                    <div class="section-controls">
                        <!-- Theme Toggle Button -->
                        <button type="button" class="theme-toggle" id="themeToggle" title="ÂàáÊèõ‰∏ªÈ°å">
                            <span class="theme-icon" id="themeIcon">üå§Ô∏è</span>
                        </button>
                        <!-- Settings Button -->
                        <div class="settings-dropdown">
                            <button type="button" class="settings-toggle" id="settingsToggle" title="Ë®≠ÂÆö">
                                <span>‚öôÔ∏è</span>
                            </button>
                            <div class="settings-dropdown-menu" id="settingsMenu">
                                <div class="settings-group">
                                    <label data-i18n="language">Ë™ûË®Ä</label>
                                    <select id="languageSelect">
                                        <option value="zh">‰∏≠Êñá</option>
                                        <option value="en">English</option>
                                        <option value="ja">Êó•Êú¨Ë™û</option>
                                    </select>
                                </div>
                                <div class="settings-group">
                                    <label data-i18n="currency">Âπ£Âà•</label>
                                    <select id="currencySelect">
                                        <option value="TWD">TWD (Âè∞Âπ£)</option>
                                        <option value="JPY">JPY (Êó•Âπ£)</option>
                                        <option value="USD">USD (ÁæéÈáë)</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Loan Type -->
                <div class="form-group">
                    <label data-i18n="loanType">Ë≤∏Ê¨æÈ°ûÂûã</label>
                    <div class="loan-type-container">
                        <select id="loanTypeSelect">
                            <option value="mortgage" data-i18n="mortgage">ÊàøË≤∏</option>
                            <option value="car" data-i18n="carLoan">ËªäË≤∏</option>
                            <option value="personal" data-i18n="personalLoan">‰ø°Ë≤∏</option>
                            <option value="other" data-i18n="other">ÂÖ∂‰ªñ</option>
                        </select>
                        <input type="text" id="customLoanType" class="hidden" placeholder="Ë´ãËº∏ÂÖ•Ë≤∏Ê¨æÈ°ûÂûã">
                    </div>
                </div>

                <!-- Loan Amount -->
                <div class="form-group">
                    <label data-i18n="loanAmount">Ë≤∏Ê¨æÈáëÈ°ç</label>
                    <div class="input-with-unit">
                        <input type="text" id="loanAmount" inputmode="numeric" pattern="[0-9,]*" value="1,000,000">
                        <span class="unit" id="currencyUnit">TWD</span>
                    </div>
                </div>

                <!-- Compact Row: Ratio, Term, Rate -->
                <div class="form-row compact-row">
                    <!-- Loan Ratio -->
                    <div class="form-group compact">
                        <label data-i18n="loanRatio">Ë≤∏Ê¨æÊàêÊï∏</label>
                        <div class="input-inline">
                            <input type="number" id="loanRatio" min="0" max="100" step="5" value="80">
                            <span class="unit-inline">%</span>
                        </div>
                    </div>

                    <!-- Loan Term -->
                    <div class="form-group compact">
                        <label data-i18n="loanTerm">Ë≤∏Ê¨æÂπ¥Èôê</label>
                        <div class="input-inline">
                            <input type="number" id="loanTerm" min="1" max="40" step="1" value="30">
                            <span class="unit-inline" data-i18n="years">Âπ¥</span>
                        </div>
                    </div>

                    <!-- Interest Rate -->
                    <div class="form-group compact">
                        <label data-i18n="interestRate">Âπ¥Âà©Áéá</label>
                        <div class="input-inline">
                            <input type="number" id="interestRate" min="0" max="30" step="0.01" value="2.0">
                            <span class="unit-inline">%</span>
                        </div>
                    </div>
                </div>

                <!-- Grace Period -->
                <div class="form-group grace-period-group">
                    <div class="grace-period-header">
                        <label data-i18n="gracePeriod">ÂØ¨ÈôêÊúü</label>
                        <label class="toggle-switch">
                            <input type="checkbox" id="gracePeriodToggle">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div class="grace-period-inputs" id="gracePeriodInputs">
                        <div class="input-with-select">
                            <input type="number" id="gracePeriod" min="0" max="10" step="1" value="1">
                            <select id="gracePeriodUnit">
                                <option value="years" data-i18n="years">Âπ¥</option>
                                <option value="months" data-i18n="months">ÂÄãÊúà</option>
                            </select>
                        </div>
                        <small class="hint" data-i18n="gracePeriodHint">ÂØ¨ÈôêÊúüÂÖßÂè™Áπ≥Âà©ÊÅØÔºå‰∏çÈÇÑÊú¨Èáë</small>
                    </div>
                </div>

                <!-- Payment Method -->
                <div class="form-group">
                    <label data-i18n="paymentMethod">ÈÇÑÊ¨æÊñπÂºè</label>
                    <select id="paymentMethod">
                        <option value="equalPayment" data-i18n="equalPayment">Êú¨ÊÅØÂπ≥ÂùáÊî§ÈÇÑÔºàÁ≠âÈ°çÊú¨ÊÅØÔºâ</option>
                        <option value="equalPrincipal" data-i18n="equalPrincipal">Êú¨ÈáëÂπ≥ÂùáÊî§ÈÇÑÔºàÁ≠âÈ°çÊú¨ÈáëÔºâ</option>
                    </select>
                </div>

                <!-- Additional Costs Section -->
                <div class="form-group costs-section">
                    <div class="costs-header">
                        <label data-i18n="additionalCosts">È°çÂ§ñË≤ªÁî®</label>
                        <button type="button" id="addCostBtn" class="btn-add">+</button>
                    </div>
                    <div id="costsContainer"></div>
                    <div class="total-costs">
                        <span data-i18n="totalCosts">Á∏ΩÈ°çÂ§ñË≤ªÁî®Ôºö</span>
                        <span id="totalCostsValue">0</span>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="action-buttons">
                    <button type="button" id="resetBtn" class="btn-secondary" data-i18n="reset">ÈáçÁΩÆ</button>
                    <button type="button" id="calculateBtn" class="btn-primary" data-i18n="calculate">Ë®àÁÆó</button>
                </div>
            </section>

            <!-- Results Section -->
            <section class="results-section" id="resultsSection">
                <div class="results-header">
                    <h2 data-i18n="results">Ë®àÁÆóÁµêÊûú</h2>
                    <div class="share-dropdown">
                        <button type="button" class="btn-share-main" id="shareDropdownBtn" title="ÂåØÂá∫/ÂàÜ‰∫´">
                            <span>üì§</span>
                        </button>
                        <div class="share-dropdown-menu" id="shareDropdownMenu">
                            <button type="button" id="exportCSV" class="dropdown-item">
                                <span>üìÑ</span> CSV
                            </button>
                            <button type="button" id="exportExcel" class="dropdown-item">
                                <span>üìä</span> Excel
                            </button>
                            <button type="button" id="exportPDF" class="dropdown-item">
                                <span>üìë</span> PDF
                            </button>
                            <hr class="dropdown-divider">
                            <button type="button" id="shareBtn" class="dropdown-item">
                                <span>üîó</span> <span data-i18n="share">ÂàÜ‰∫´</span>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Summary Cards -->
                <div class="summary-cards">
                    <div class="card card-monthly-payment">
                        <h3 data-i18n="monthlyPayment">ÊØèÊúàÈÇÑÊ¨æÈáëÈ°ç</h3>
                        <div class="monthly-payment-display">
                            <p id="monthlyPaymentValue" class="value">-</p>
                            <div class="grace-toggle-container" id="graceToggleContainer" style="display: none;">
                                <div class="grace-payment-toggle">
                                    <span class="toggle-label" data-i18n="gracePeriodPayment">ÂØ¨ÈôêÊúüÂÖß</span>
                                    <label class="mini-toggle">
                                        <input type="checkbox" id="gracePaymentToggle">
                                        <span class="mini-toggle-slider"></span>
                                    </label>
                                    <span class="toggle-label" data-i18n="postGracePeriodPayment">ÂØ¨ÈôêÊúüÂæå</span>
                                </div>
                                <p id="gracePaymentValue" class="value grace-value">-</p>
                            </div>
                        </div>
                    </div>
                    <div class="card card-apr">
                        <h3 data-i18n="apr">Á∏ΩË≤ªÁî®Âπ¥ÁôæÂàÜÁéá</h3>
                        <p id="aprValue" class="value">-</p>
                    </div>
                    <!-- Collapsible Details -->
                    <div class="card card-details-toggle" id="detailsToggle">
                        <span class="toggle-icon" id="detailsToggleIcon">+</span>
                        <span data-i18n="viewDetails">Êü•ÁúãË©≥Á¥∞</span>
                    </div>
                    <div class="details-container" id="detailsContainer" style="display: none;">
                        <div class="card">
                            <h3 data-i18n="totalPayment">Á∏ΩÈÇÑÊ¨æÈáëÈ°ç</h3>
                            <p id="totalPaymentValue" class="value">-</p>
                        </div>
                        <div class="card">
                            <h3 data-i18n="totalInterest">Á∏ΩÂà©ÊÅØ</h3>
                            <p id="totalInterestValue" class="value">-</p>
                        </div>
                    </div>
                </div>

                <!-- Charts -->
                <div class="charts-container">
                    <div class="chart-wrapper">
                        <div class="chart-header">
                            <h3 data-i18n="paymentChart">ÈÇÑÊ¨æÈáëÈ°çË∂®Âã¢Âúñ</h3>
                            <div class="chart-actions">
                                <button type="button" class="btn-magnify" id="magnifyPaymentChart" title="Êü•ÁúãË©≥Á¥∞">
                                    üîç
                                </button>
                                <button type="button" class="btn-fullscreen" data-target="paymentChartFull" title="ÂÖ®Ëû¢Âπï">
                                    ‚õ∂
                                </button>
                            </div>
                        </div>
                        <div class="chart-scroll-container">
                            <canvas id="paymentChart"></canvas>
                        </div>
                    </div>
                    <div class="chart-wrapper">
                        <div class="chart-header">
                            <h3 data-i18n="balanceChart">Êú¨ÈáëÂà©ÊÅØÁ¥ØË®àÂúñ</h3>
                            <div class="chart-actions">
                                <button type="button" class="btn-magnify" id="magnifyBalanceChart" title="Êü•ÁúãË©≥Á¥∞">
                                    üîç
                                </button>
                                <button type="button" class="btn-fullscreen" data-target="balanceChartFull" title="ÂÖ®Ëû¢Âπï">
                                    ‚õ∂
                                </button>
                            </div>
                        </div>
                        <div class="chart-scroll-container">
                            <canvas id="balanceChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Chart Detail Modal -->
                <div class="modal-overlay" id="chartModal">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3 id="modalTitle">Ë©≥Á¥∞Ë≥áË®ä</h3>
                            <button type="button" class="modal-close" id="modalClose">&times;</button>
                        </div>
                        <div class="modal-body">
                            <div class="period-selector">
                                <label data-i18n="period">ÊúüÊï∏</label>
                                <input type="range" id="periodSlider" min="1" max="240" value="1">
                                <span id="periodDisplay">1</span>
                            </div>
                            <div class="period-details" id="periodDetails">
                                <!-- Period details will be populated here -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Fullscreen Modal -->
                <div class="fullscreen-overlay" id="fullscreenModal">
                    <div class="fullscreen-content">
                        <div class="fullscreen-header">
                            <h3 id="fullscreenTitle">ÂÖ®Ëû¢ÂπïÊ™¢Ë¶ñ</h3>
                            <button type="button" class="fullscreen-close" id="fullscreenClose">&times;</button>
                        </div>
                        <div class="fullscreen-body" id="fullscreenBody">
                            <!-- Content will be cloned here -->
                        </div>
                    </div>
                </div>

                <!-- Amortization Table -->
                <div class="table-container">
                    <div class="table-header">
                        <h3 data-i18n="amortizationSchedule">ÈÇÑÊ¨æÊòéÁ¥∞Ë°®</h3>
                        <div class="chart-actions">
                            <button type="button" class="btn-fullscreen" data-target="tableFull" title="ÂÖ®Ëû¢Âπï">
                                ‚õ∂
                            </button>
                        </div>
                    </div>
                    <div class="table-scroll">
                        <table id="amortizationTable">
                            <thead>
                                <tr>
                                    <th data-i18n="period">ÊúüÊï∏</th>
                                    <th data-i18n="payment">ÈÇÑÊ¨æÈáëÈ°ç</th>
                                    <th data-i18n="principal">Êú¨Èáë</th>
                                    <th data-i18n="interest">Âà©ÊÅØ</th>
                                    <th data-i18n="cumulativePrincipal">Á¥ØË®àÊú¨Èáë</th>
                                    <th data-i18n="cumulativeInterest">Á¥ØË®àÂà©ÊÅØ</th>
                                    <th data-i18n="remainingBalance">Ââ©È§òÊú¨Èáë</th>
                                </tr>
                            </thead>
                            <tbody id="amortizationBody"></tbody>
                        </table>
                    </div>
                </div>

            </section>
        </main>

        <!-- Footer -->
        <footer class="footer">
            <p data-i18n="footer">¬© 2026 Ë≤∏Ê¨æË®àÁÆóÊ©ü</p>
        </footer>
    </div>

    <!-- Load local libraries -->
    <script src="libs/chart.min.js"></script>
    <script src="libs/jspdf.min.js"></script>
    <script src="libs/jspdf.plugin.autotable.min.js"></script>
    <script src="libs/xlsx.min.js"></script>

    <!-- App scripts -->
    <script src="i18n.js"></script>
    <script src="calculator.js"></script>
    <script src="app.js"></script>
</body>

</html>
